<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>지도 생성하기</title>
	<style>
        #map { width: 100%; height: 1000px; }
        .infowindow-content { position: relative; }
        .infowindow-close { position: absolute; top: 5px; right: 5px; cursor: pointer; }
        .infowindow-register { margin-top: 10px; text-align: center; }
		.infowindow-buttons { text-align: center; margin-top: 10px; }
        .infowindow-button { margin: 5px; }
    </style>

</head>
<body>
<!-- 지도를 표시할 div 입니다 -->
<div id="map" ></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d502ef8977e585cc483511208b13312e&libraries=services"></script>
<script>
    var mapContainer = document.getElementById('map'), 
        mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667), 
            level: 3 
        };
    
    var map = new kakao.maps.Map(mapContainer, mapOption);

    var geocoder = new kakao.maps.services.Geocoder();
    var markers = [];
	var currentInfoWindow = null;


    function searchPlaces() {
        var keyword = document.getElementById('keyword').value;
        if (!keyword.trim()) {
            alert('키워드를 입력해주세요!');
            return false;
        }

        var ps = new kakao.maps.services.Places(); 
        ps.keywordSearch(keyword, placesSearchCB); 
    }

    function placesSearchCB(data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {
            var bounds = new kakao.maps.LatLngBounds();

            for (var i = 0; i < data.length; i++) {
                displayMarker(data[i]);    
                bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            }       

            map.setBounds(bounds);
        } 
    }

    function displayMarker(place) {
        var marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(place.y, place.x) 
        });
		
		var infowindow = new kakao.maps.InfoWindow({
			content: '<div class="infowindow-content">' +
					  '<table border="1" width="150px" height="200" cellspacing="5">' +
					  '<caption>민원 맵</caption>' +
					  '<tbody>' +
					  '<tr align="center" bgcolor="white"><th>내용</th><td>100원</td></tr>' +
					  '<tr align="center" bgcolor="white"><th>지역</th><td>100원</td></tr>' +
					  '<tr align="center" bgcolor="white"><th>날짜</th><td>100원</td></tr>' +
					  '<tr align="center" bgcolor="white"><th>상태</th><td>100원</td></tr>' +
					  '</tbody></table>' +
					  '<div class="infowindow-buttons">' +
					  '<button class="infowindow-button" onclick="closeInfoWindow()">닫기</button>' +
					  '<button class="infowindow-button" onclick="registerComplaint(\'' + place.place_name + '\')">민원 등록</button>' +
					  '</div>' +
					  '</div>'
		});


        kakao.maps.event.addListener(marker, 'click', function() {
			if (currentInfoWindow) {
				currentInfoWindow.close();
			}

			infowindow.open(map, marker);
			currentInfoWindow = infowindow;
         //   registerComplaint(place);
        });

        markers.push(marker);
    }


	function closeInfoWindow() {
		if (currentInfoWindow) {
			currentInfoWindow.close();
			currentInfoWindow = null;
		}
	}

    function registerComplaint(place) {
		alert('민원이 등록되었습니다: ' + placeName);
		closeInfoWindow();
    }

    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
        var latlng = mouseEvent.latLng;

        var marker = new kakao.maps.Marker({
            position: latlng,
            map: map
        });
		
		var infowindow = new kakao.maps.InfoWindow({
			content: '<div class="infowindow-content">' +
					  '<table border="1" width="150px" height="200" cellspacing="5">' +
					  '<caption>민원 맵</caption>' +
					  '<tbody>' +
					  '<tr align="center" bgcolor="white"><th>내용</th><td>100원</td></tr>' +
					  '<tr align="center" bgcolor="white"><th>지역</th><td>100원</td></tr>' +
					  '<tr align="center" bgcolor="white"><th>날짜</th><td>100원</td></tr>' +
					  '<tr align="center" bgcolor="white"><th>상태</th><td>100원</td></tr>' +
					  '</tbody></table>' +
					  '<div class="infowindow-buttons">' +
					  '<button class="infowindow-button" onclick="closeInfoWindow()">닫기</button>' +
					  '<button class="infowindow-button" onclick="registerComplaint(\'지정된 위치\')">민원 등록</button>' +
					  '</div>' +
					  '</div>'
		});

		kakao.maps.event.addListener(marker, 'click', function() {
			if (currentInfoWindow) {
				currentInfoWindow.close();
			}	

			infowindow.open(map, marker);
			currentInfoWindow = infowindow;

			//registerComplaint({ place_name: '지정된 위치', y: latlng.getLat(), x: latlng.getLng() });
		});

        markers.push(marker);
    });
</script>
</body>
</html>
